#!bin/bash

# set -euo pipefail
set -e # Exit on error
set -u # Exit on undefined variable
set -o pipefail # Return the exit status of the last command in the pipeline that failed
set -x # Debug mode

echo "Starting system setup..."

# Update system and install necessary packages
sudo pacman -Syu --noconfirm
sudo pacman -S --needed --noconfirm git curl base-devel ansible

( # Subshell
    # Configure Git
    printf "Enter your GitHub username: \n"
    read github_username < /dev/tty

    printf "Enter your GitHub email: \n"
    read github_email < /dev/tty

    git config --global user.name "$github_username"
    git config --global user.email "$github_email"
)

# Clone the dotfiles repository
git clone https://github.com/albertopingo/dotfiles.git ~/.dotfiles
cd ~/.dotfiles

# Install yay
if ! command -v yay &> /dev/null; then
    echo "Installing yay..."
    git clone https://aur.archlinux.org/yay.git /tmp/yay
    cd /tmp/yay
    makepkg -si --noconfirm
    rm -rf /tmp/yay
else
    echo "yay is already installed."
fi

echo "System setup complete."